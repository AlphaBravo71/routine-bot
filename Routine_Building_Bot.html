<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Routine Building Chatbot</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    #chat { border: 1px solid #ccc; padding: 1em; height: 300px; overflow-y: scroll; margin-bottom: 1em; }
    input, button { padding: 0.5em; }
    #userInput { width: 60%; }
    #submitButton { display: none; margin-top: 1em; }
  </style>
</head>
<body>
  <h2>Routine Building Coach Bot</h2>
  <div id="chat">
    <p><strong>Coach:</strong> Hi! Let’s reflect on Routine Building. What’s one moment in your day that consistently causes friction, confusion, or wasted time?</p>
  </div>
  <input type="text" id="userInput" placeholder="Type your response here..." />
  <button onclick="sendMessage()">Send</button>
  <button id="submitButton">Submit Reflection</button>

  <script>
    const apiKey = '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'; 
    const chat = document.getElementById("chat");
    const userInput = document.getElementById("userInput");
    const submitButton = document.getElementById("submitButton");
    let userTurnCount = 0;
    let conversationComplete = false;

    let messages = [
      {
        role: "system",
        content: `You are a supportive, structured instructional coach trained in BASIS Ed’s model for Routine Building. Your job is to guide a teacher through a focused, 6-question reflection on one routine they are working to build or refine.

Only discuss Routine Building as defined by BASIS Ed: teaching systems that help students do the right thing automatically. Focus only on the six-step process:
1. Identify the high-friction moment
2. Script the ideal routine
3. Model it clearly
4. Practice repeatedly
5. Reinforce with praise or correction
6. Aim for fluency—not perfection

If the teacher brings up unrelated topics (behavior management, rules, SEL, general compliance), respond once with a warm redirection like: “That’s important, but let’s stay focused on how you’re designing and reinforcing routines.”

Ask up to 6 follow-up questions. After the 6th, stop. Provide a final paragraph of narrative feedback with:
- Strengths
- One growth suggestion
- An encouraging next step

Do not ask any more questions or continue the conversation beyond that summary.`
      },
      {
        role: "assistant",
        content: "Hi! Let’s reflect on Routine Building. What’s one moment in your day that consistently causes friction, confusion, or wasted time?"
      }
    ];

    async function sendMessage() {
      const userText = userInput.value.trim();
      if (!userText || conversationComplete) return;

      chat.innerHTML += `<p><strong>You:</strong> ${userText}</p>`;
      userInput.value = "";
      messages.push({ role: "user", content: userText });
      userTurnCount++;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: "gpt-4o",
          messages: messages
        })
      });

      const data = await response.json();
      const botReply = data.choices[0].message.content;
      messages.push({ role: "assistant", content: botReply });
      chat.innerHTML += `<p><strong>Coach:</strong> ${botReply}</p>`;
      chat.scrollTop = chat.scrollHeight;

      if (userTurnCount >= 6) {
        userInput.disabled = true;
        conversationComplete = true;
        submitButton.style.display = 'inline';
      }
    }
  </script>
</body>
</html>

